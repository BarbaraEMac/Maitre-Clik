{% extends 'base.html' %}

{% block content %}
        <div id="audio"></div>
        <div id="qrContainer"></div>

        <div class="span-8">
            <img src="/static/imgs/waiter.jpg" />

            <a href="{% url ShowStats %}">Stats</a>
        </div>

		<div class="span-16 last">
            <h1 id="title">Bonjour</h1>
        </div>
{% endblock content %}

{% block javascript %}
		<script src="/static/js/speakClient.js"></script>

        <script>
            var maitre = new function() {
                this.init = function( ) {
                    // Populate with current users when connection established
                    clik.on('connect', function () {
                        return;
                    });

                    // A user has joined the conference
                    clik.on('join', function ( name ) {

                        welcome( name );

                    });

                    // A user has left the conference
                    clik.on('leave', function () {
                        // Update view
                        return;
                    });

                    // Receive chat messages and print them to the screen
                    clik.on('chat', function (chatMsg) {
                        $('#messageLog').prepend(
                            '(' + chatMsg.time + ') ' + this.id + ': ' + chatMsg.message + '<hr>'
                        );
                    });
                };

                this.run = function( ) {

                    speak("Bonne Joooure. Juh map elle Fran swa", {wordgap:5} );
                    
                    // When Clik is ready to serve events..
                    clik.ready(function () {
                        // Populate ClikCode
                        $("#qrContainer").css('background-image', 'url(' + clik.clikCodeURL() + ')');

                        // Populate conference ID
                        $("#conferenceId").val( clik.id );

                        // Populate your user ID
                        $("#participantId").val( clik.client.id );
                    });


                };

                this.welcome = function( name ) {
                    var date = new Date();

                    // If dinner time,
                    if( date.getHours() >= 16 ) { 
                        speak( "Bonne Swar" + name, {wordgap:5} );

                    } else { // If lunch time
                        speak( "Bonne Jooooure" + name, {wordgap:5 } );
                    }
                };

                // Maintain a graphical version of the participant list.
                function renderClientList () {
                    var $parts = $('#parts');

                    $parts.html('');

                    $.each(clik.clients, function (i, client) {
                        $parts.append(
                            '<li id="'+client.id+'">' + client.id + '</li>'
                        );
                    });
                };

                // Send a message
                function sendMessage (message) {
                    var time        = new Date(),
                        timeString  = time.toTimeString().split(' ')[0],
                        chatMessage = {
                            message : message,
                            time    : timeString
                        };

                    // Send message to everyone else
                    clik.send('chat', chatMessage);

                    // Send message to yourself
                    clik.trigger('chat', chatMessage, clik.client);
                };

            };

            maitre.init();
            maitre.run();
        </script>

{% endblock javascript %}
